create schema proyecto;

create table cliente(
    id int4 not null,
    Nombre varchar(100) not null unique,
    Apellido varchar(100) not null unique,
    Direccion varchar(100) not null unique ,
    Telefono int4 not null unique ,
    Email varchar(100) not null unique ,
    Usuario varchar(100) not null unique ,
    Contraseña varchar(100) not null unique ,

    constraint pk_cliente primary key (id)

);

create table empresa(
    id int4 not null,
    nom_empresa varchar(100) not null,
    direccion varchar(100) not null,
    telefono int4 not null,
    email varchar(100) not null,

    constraint pk_empresa primary key (id)

);

create table productos(
    id int4 not null,
    id_categoria int4 not null,
    id_tamaño int4 not null,
    nom_producto varchar(100) not null,
    marca varchar(100) not null unique,
    modelo varchar(100) not null unique,
    precio int4 not null unique,

    constraint pk_productos primary key (id,id_tamaño,id_categoria),
    constraint fk_categ_productos foreign key (id_categoria) references categoria(id),
    constraint fk_catal_productos foreign key (nom_producto) references catalogo(nom_producto),
    constraint fk_tamaño_productos foreign key (id_tamaño) references tamaño(id)
);

create table catalogo(
    id int4 not null,
    nom_producto varchar(100) not null unique,
    id_producto int4 not null ,
    imagen varchar(500) not null unique,

    constraint pk_catalogo primary key (id_producto, id)
    );

create table tamaño(
    id int4 not null,
    tamaño varchar(50) not null,

    constraint pk_tamaño primary key (id)
);

create table categoria(
    id int4 not null,
    nom_categoria varchar(100) not null,
    descripcion varchar(400) not null,

    constraint pk_categoria primary key (id)

);

create table inventario(
    id_productos int4 not null,
    id_cliente int4 not null,
    existencia varchar(20) not null,

    constraint pk_inventario primary key (id_productos,id_cliente),
    constraint fk_prod_inven foreign key (id_productos) references productos(id),
    constraint fk_client_invent foreign key (id_cliente) references cliente(id)
);

create table detalle_pedido(
    id int4 not null,
    id_cliente int4 not null,
    fecha date not null,

    constraint pk_detalle_pedido primary key (id,id_cliente),
    constraint fk_clien_detped foreign key (id_cliente) references cliente(id)
)
;

create table factura(
    num_factura int4 not null,
    nombre_cliente varchar(100) not null,
    fecha date not null,

    constraint pk_factura primary key (nombre_cliente),
    constraint fk_clien_fact foreign key (nombre_cliente) references cliente (Nombre)
);

create table venta(
    id_producto int4 not null,
    fecha date not null,
    id_cliente int4 not null,
    total_a_pagar int4 not null,
    estado varchar(25) not null,

    constraint pk_id_producto primary key (id_producto,id_cliente),
    constraint fk_prod_venta foreign key (id_producto) references productos(id),
    constraint fk_clien_venta foreign key (id_cliente) references cliente(id)
);

create table carrito_compras(
    id_producto int4 not null,
    nom_producto varchar(100) not null,
    descuento varchar(100) not null,

    constraint pk_produc_carcom primary key (id_producto,nom_producto),
    constraint fk_produc_carcom foreign key (id_producto,nom_producto) references productos(id, nom_producto)
);

create table historial_compras(
    fecha_compra date not null,
    id_cliente int4 not null ,
    id_producto int4 not null,
    cantidad int4 not null,

    constraint pk_hist_compras primary key (fecha_compra,id_cliente,id_producto),
    constraint fk_clien_hiscom foreign key (id_cliente) references cliente(id),
    constraint fk_prod_hiscom foreign key (id_producto) references productos(id)
);

create table historial_ventas(
    fecha_venta date not null,
    id_producto int4 not null,
    id_cliente int4 not null,
    cantidad int4 not null,

    constraint pk_hist_comp primary key (fecha_venta,id_producto,id_cliente),
    constraint fk_prod_histcomp foreign key (id_producto) references productos(id),
    constraint fk_clie_histcomp foreign key (id_cliente) references cliente(id)
);